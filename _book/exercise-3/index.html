
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Deploy Guestbook Application Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../exercise-4/" />
    
    
    <link rel="prev" href="../exercise-2/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">KubeCon Istio Workshop</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../exercise-1/">
            
                <a href="../exercise-1/">
            
                    
                    Accessing a cluster with IKS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../exercise-2/">
            
                <a href="../exercise-2/">
            
                    
                    Installing Istio
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.3" data-path="./">
            
                <a href="./">
            
                    
                    Deploy Guestbook Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="../exercise-4/">
            
                <a href="../exercise-4/">
            
                    
                    Metrics and Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="../exercise-5/">
            
                <a href="../exercise-5/">
            
                    
                    Expose with Istio Gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6" data-path="../exercise-6/">
            
                <a href="../exercise-6/">
            
                    
                    Traffic Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7" data-path="../exercise-7/">
            
                <a href="../exercise-7/">
            
                    
                    Secure your service mesh
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="../exercise-8/">
            
                <a href="../exercise-8/">
            
                    
                    Enforce policies for microservices
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Deploy Guestbook Application</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="exercise-3---deploy-the-guestbook-app-with-istio-proxy">Exercise 3 - Deploy the Guestbook app with Istio Proxy</h1>
<p>The Guestbook app is a sample app for users to leave comments. It consists of a web front end, Redis master for storage, and a replicated set of Redis slaves. We will also integrate the app with Watson Tone Analyzer that detects the sentiment in user&apos;s comments and replies with emoticons. Here are the steps to deploy the app on your Kubernetes cluster:</p>
<h3 id="download-the-guestbook-app">Download the Guestbook app</h3>
<ol>
<li><p>Open your preferred terminal and download the Guestbook app from GitHub into the <code>workshop</code> directory.</p>
<pre><code class="lang-shell"> git clone https://github.com/IBM/guestbook.git ../guestbook
</code></pre>
</li>
<li><p>Navigate into the app directory.</p>
<pre><code class="lang-shell"> cd ../guestbook/v2
</code></pre>
</li>
</ol>
<h3 id="create-a-redis-database">Create a Redis database</h3>
<p>The Redis database is a service that you can use to persist the data of your app. The Redis database comes with a master and slave modules.</p>
<ol>
<li><p>Create the Redis controllers and services for both the master and the slave.</p>
<pre><code class="lang-shell"> kubectl create -f redis-master-deployment.yaml
 kubectl create -f redis-master-service.yaml
 kubectl create -f redis-slave-deployment.yaml
 kubectl create -f redis-slave-service.yaml
</code></pre>
</li>
<li><p>Verify that the Redis controllers for the master and the slave are created.</p>
<pre><code class="lang-shell"> kubectl get deployment
</code></pre>
<p> Output:</p>
<pre><code class="lang-shell"> NAME           DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
 redis-master   1         1         1            1           5d
 redis-slave    2         2         2            2           5d
</code></pre>
</li>
<li><p>Verify that the Redis services for the master and the slave are created.</p>
<pre><code class="lang-shell"> kubectl get svc
</code></pre>
<p> Output:</p>
<pre><code class="lang-shell"> NAME           TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE
 redis-master   ClusterIP      172.21.85.39    &lt;none&gt;          6379/TCP       5d
 redis-slave    ClusterIP      172.21.205.35   &lt;none&gt;          6379/TCP       5d
</code></pre>
</li>
<li><p>Verify that the Redis pods for the master and the slave are up and running.</p>
<pre><code class="lang-shell"> kubectl get pods
</code></pre>
<p> Output:</p>
<pre><code class="lang-shell"> NAME                            READY     STATUS    RESTARTS   AGE
 redis-master-4sswq              1/1       Running   0          5d
 redis-slave-kj8jp               1/1       Running   0          5d
 redis-slave-nslps               1/1       Running   0          5d
</code></pre>
</li>
</ol>
<h2 id="sidecar-injection">Sidecar injection</h2>
<p>In Kubernetes, a sidecar is a utility container in the pod, and its purpose is to support the main container. For Istio to work, Envoy proxies must be deployed as sidecars to each pod of the deployment. There are two ways of injecting the Istio sidecar into a pod: manually using the istioctl CLI tool or automatically using the Istio Initializer. In this exercise, we will use the manual injection. Manual injection modifies the controller configuration, e.g. deployment. It does this by modifying the pod template spec such that all pods for that deployment are created with the injected sidecar.</p>
<h2 id="install-the-guestbook-app-with-manual-sidecar-injection">Install the Guestbook app with manual sidecar injection</h2>
<ol>
<li><p>Inject the Istio Envoy sidecar into the guestbook pods, and deploy the Guestbook app on to the Kubernetes cluster.</p>
<pre><code class="lang-shell"> kubectl apply -f &lt;(istioctl kube-inject -f ../v1/guestbook-deployment.yaml)
 kubectl apply -f &lt;(istioctl kube-inject -f guestbook-deployment.yaml)
</code></pre>
</li>
</ol>
<p>These commands will inject the Istio Envoy sidecar into the guestbook pods, as well as deploy the Guestbook app on to the Kubernetes cluster. Here we have two versions of deployments, a new version (<code>v2</code>) in the current directory, and a previous version (<code>v1</code>) in a sibling directory. They will be used in future sections to showcase the Istio traffic routing capabilities.</p>
<ol>
<li><p>Create the guestbook service.</p>
<pre><code class="lang-shell"> kubectl create -f guestbook-service.yaml
</code></pre>
</li>
<li><p>Verify that the service was created.</p>
<pre><code class="lang-shell"> kubectl get svc
</code></pre>
<p> Output:</p>
<pre><code class="lang-shell"> NAME           TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE
 guestbook      LoadBalancer   172.21.36.181   169.61.37.140   80:32149/TCP   5d
</code></pre>
<p> <strong>Note: For Lite clusters, the external ip will not be available. That is expected.</strong></p>
</li>
<li><p>Verify that the pods are up and running.</p>
<pre><code class="lang-shell"> kubectl get pods
</code></pre>
<p> Output:</p>
<pre><code class="lang-shell"> NAME                            READY     STATUS    RESTARTS   AGE
 guestbook-v1-89cd4b7c7-frscs    2/2       Running   0          5d
 guestbook-v1-89cd4b7c7-jn224    2/2       Running   0          5d
 guestbook-v1-89cd4b7c7-m7hmd    2/2       Running   0          5d
 guestbook-v2-56d98b558c-7fvd5   2/2       Running   0          5d
 guestbook-v2-56d98b558c-dshkh   2/2       Running   0          5d
 guestbook-v2-56d98b558c-mzbxk   2/2       Running   0          5d
</code></pre>
<p> Note that each guestbook pod has 2 containers in it. One is the guestbook container, and the other is the Envoy proxy sidecar.</p>
</li>
</ol>
<h3 id="use-watson-tone-analyzer">Use Watson Tone Analyzer</h3>
<p>Watson Tone Analyzer detects the tone from the words that users enter into the Guestbook app. The tone is converted to the corresponding emoticons.</p>
<ol>
<li><p>Create Watson Tone Analyzer in your account.</p>
<pre><code class="lang-shell"> ibmcloud resource service-instance-create my-tone-analyzer-service tone-analyzer lite us-south
</code></pre>
</li>
<li><p>Create the service key for the Tone Analyzer service. This command should output the credentials you just created. You will need the value for <strong>apikey</strong> &amp; <strong>url</strong> later.</p>
<pre><code class="lang-shell"> ibmcloud resource service-key-create tone-analyzer-key Manager --instance-name my-tone-analyzer-service
</code></pre>
</li>
<li><p>If you need to get the service-keys later, you can use the following command:</p>
<pre><code class="lang-shell"> ibmcloud resource service-key tone-analyzer-key
</code></pre>
</li>
<li><p>Open the <code>analyzer-deployment.yaml</code> and find the env section near the end of the file. Replace YOUR_API_KEY with your own API key, and replace YOUR_URL with the url value you saved before. YOUR_URL should look something like <code>gateway.watsonplatform.net/tone-analyzer/api</code>. Save the file.</p>
</li>
<li><p>The analyzer service will use IBM Cloud Identity and Access management (IAM) tokens to make authenticated requests to the Tone Analyzer service. IAM authentication uses access tokens for authentication, which are acquired by sending a request to a url with an API key. As a result, we will need to set up egress rules to allow the analyzer service access to those external urls. Apply the egress rules found in the <code>istio101/workshop/plans</code> directory</p>
<pre><code class="lang-shell"> cd ../../plans
 kubectl apply -f analyzer-egress.yaml
</code></pre>
</li>
<li><p>Deploy the analyzer pods and service, using the <code>analyzer-deployment.yaml</code> and <code>analyzer-service.yaml</code> files found in the <code>guestbook/v2</code> directory. The analyzer service talks to Watson Tone Analyzer to help analyze the tone of a message.</p>
<pre><code class="lang-shell"> cd ../guestbook/v2/
 kubectl apply -f &lt;(istioctl kube-inject -f analyzer-deployment.yaml)
 kubectl apply -f analyzer-service.yaml
</code></pre>
</li>
</ol>
<p>Great! Your guestbook app is up and running. In Exercise 4, you&apos;ll be able to see the app in action by directly accessing the service endpoint. You&apos;ll also be able to view Telemetry data for the app.</p>
<h4 id="continue-to-exercise-4---telemetry"><a href="../exercise-4/">Continue to Exercise 4 - Telemetry</a></h4>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../exercise-2/" class="navigation navigation-prev " aria-label="Previous page: Installing Istio">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../exercise-4/" class="navigation navigation-next " aria-label="Next page: Metrics and Tracing">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Deploy Guestbook Application","level":"1.1.3","depth":2,"next":{"title":"Metrics and Tracing","level":"1.1.4","depth":2,"path":"exercise-4/README.md","ref":"exercise-4/README.md","articles":[]},"previous":{"title":"Installing Istio","level":"1.1.2","depth":2,"path":"exercise-2/README.md","ref":"exercise-2/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["livereload"],"root":"./workshop","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"exercise-3/README.md","mtime":"2018-12-04T14:26:03.141Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-12-04T14:50:20.706Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

